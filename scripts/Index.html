<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Disaster Dept | Public Safety</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white overflow-x-hidden font-sans">
    <div class="absolute top-8 right-8 z-50">
        <a href="/monitor.html" class="px-6 py-3 bg-white/5 border border-white/10 rounded-full text-[10px] font-bold uppercase transition-all">Admin Portal â†’</a>
    </div>
    <section id="hero-bg" class="min-h-screen flex flex-col items-center justify-center transition-colors duration-1000 bg-slate-950">
        <div class="text-center space-y-6">
            <h1 id="main-status" class="text-8xl font-black italic uppercase">ALL CLEAR</h1>
            <p id="sub-status" class="text-slate-400 text-xl">Kothamangalam seismic levels are currently stable.</p>
        </div>
    </section>
    <script>
        // Determine backend URL: try current origin first (local dev), then Render backend
        const backendUrl = window.location.hostname === 'localhost' 
            ? window.location.origin 
            : 'https://tink-her-hack-q5dc.onrender.com'; // Render deployed backend URL

        console.log('ðŸ”— Connecting to backend:', backendUrl);
        const socket = io(backendUrl, { 
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionDelayMax: 5000,
            reconnectionAttempts: 5 
        });

        socket.on('connect', () => {
            console.log('âœ… Socket connected to backend');
        });

        socket.on('connect_error', (err) => {
            console.error('âŒ Socket connection error:', err);
        });

        socket.on('disconnect', (reason) => {
            console.warn('âš ï¸ Socket disconnected:', reason);
        });

        socket.on('MONITOR_UPDATE', (data) => {
            console.log('ðŸ“¡ MONITOR_UPDATE received:', data);
            const mag = parseFloat(data.magnitude);
            const hero = document.getElementById('hero-bg');
            const main = document.getElementById('main-status');

            if (mag >= 7.0) {
                hero.className = "min-h-screen flex flex-col items-center justify-center bg-red-600 transition-colors duration-1000";
                main.innerText = "EVACUATE";
            } else if (mag >= 5.0) {
                hero.className = "min-h-screen flex flex-col items-center justify-center bg-orange-600 transition-colors duration-1000";
                main.innerText = "TREMOR";
            } else if (mag < 2.5) {
                // Clear condition: revert to safe state
                hero.className = "min-h-screen flex flex-col items-center justify-center transition-colors duration-1000 bg-slate-950";
                main.innerText = "ALL CLEAR";
            } else {
                // For intermediate values, reset visual but keep a neutral status
                hero.className = "min-h-screen flex flex-col items-center justify-center transition-colors duration-1000 bg-slate-900";
                main.innerText = "WATCH";
            }
        });
    </script>
</body>
</html>